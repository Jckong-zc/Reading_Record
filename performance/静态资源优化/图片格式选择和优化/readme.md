# 图片格式和应用场景

## JPEG

联合图像专家小组，针对彩色照片广泛使用的**有损压缩图片格式**

- 栅格图形，常用扩展名为 .jpg, .jpeg, .jpe，常用于存储和传输照片
- 不适合：线条图形和文字、图标图形(压缩算法不适合)，**不支持透明度**
- **适合颜色丰富的照片**、彩色图大焦点图、banner 图，商品详情图，结构不规则的图形

## PNG

便携式网络图形，**无损压缩的位图图形格式**，支持索引(将某种颜色表现为数字形式的模型)、灰度(是用0到255的不同灰度值来表示图)、RGB 三种颜色方案以及 Alpha 通道(指一张图片的透明和半透明度)等特性

- 栅格图形，最初做为代替 GIF 的设计，可显示 256 色，比 JPEG 和 GIF 更大，但保留了图片质量。支持 Alpha 通道的**半透明性和透明性**，最高支持 24 位彩色图像(PNG-24) 和 8 位灰度图像(PNG-8)
- 无损压缩存储，彩色图像体积太大(同样形式图片会更大，不适合做大图)
- 适合
  - 纯色、透明、线条绘图
  - 图标
  - 边缘清晰、有大块相同的颜色区域
  - 颜色数较少但**需要半透明**
  - **适合设计本身并不大的图片，小图**

## GIF

图像互换格式，**位图图形文件格式**，以 8 位色(即 256 种颜色)重现真彩色的图像，采用 LZW 压缩算法进行编码

LZW 压缩算法：又叫“**串表压缩算法**”就是通过建立一个字符串表，用较短的代码来表示较长的字符串来实现压缩

- 栅格图形，支持 256 色，仅支持完全透明和完全不透明，**如果需要比较通用的动画，GIF 是唯一选择**
- 不适合存储彩色图片（每个像素只有 8 比特）
- 适合动画和可动的图标

## Webp

现代图像格式，google 新的图片格式标准，**可提供有损压缩和无损压缩**

- 保证图片质量和较小的体积

- 可以插入多帧实现动画效果，**比 GIF 有更好的动画**

- **可以设置透明度**，采用 8 位压缩算法

- 在效果一样的前提下，省下至少 28%-40% 的大小，变相提升网页的性能，无损的 Webp 比 PNG 小 26%，有损的 Webp 比 JPEG 小 25%-34%

- 最多处理 256 色，**不适合彩色图片（JPEG 那种）**

- 适合图形和半透明图像，**在重要位置的图片使用 webp 代替 jpg**   

  举例：https://img11.360buyimg.com/pop/s1180x940_jfs/t1/103557/6/14052/88126/5e5efa66E8b8e2594/71b285b0414267a8.jpg.webp 


## 实际例子

京东官网

开发者工具 -> network/img 中查看图片的格式

1. banner 轮播图：webp、jpg

2. 京东 logo：gif

3. 右侧话费/机票/酒店等小图标 icon：png

4. webp 有些浏览器不支持 

   **使用 node 进行图片处理，提供两套图片，如果不支持还是显示 jpg** 

   压缩后像素点还是一样的

   例如：http://img10.360buyimg.com/mobilecms/s280x280_jfs/t1/123549/18/3483/159576/5ed1c347E7f79159a/97364b2d7867ca31.jpg.webp

## 用工具进行图片压缩

### 压缩 png

- 使用 node-pngquant-native
- 跨平台，压缩比高，压缩 png24 非常好


### 压缩 jpg

- 使用 jpegtran
- jpegtran -copy none -optimize -outfile out.jpg in.jpg

### 压缩 gif

- 使用 Gifsicle
- 通过改变每帧比例，减小 gif 文件大小，同时可以使用透明来达到更小的文件大小
- 优化级别设置为不小于 2，设置为 1 基本不压缩 gifsicle --optimize=3 -o out.gif in.gif
- 将透明部分截去 gifsicle --optimize=3 --crop-transparency -o out.gif in.gif

## 图片尺寸随网络环境变化

不同网络环境下加载不同尺寸和像素的图片，通过在图片 URL 后缀加不同参数改变

https://img13.360buyimg.com/babel/s380x300_jfs/t1/127757/40/3636/72303/5ed47773E5e1d4838/bdb4504c58fd0201.jpg

s380x300 -> 图片尺寸参数

## 响应式图片

- JS 绑定事件检测窗口大小

- CSS 媒体查询

  ```css
  @media screen and (max-width: 640px) {
      my_image { width: 640px; }
  }
  ```

- img 标签属性

  ```html
  <img srcset="img-320w.jpg,img-640w.jpx 2x,img-960w 3x" src="img-960w.jpg alt="img"/>
  ```

  x 描述符：表示图像的设备像素比

## 逐步加载图片

- 使用统一占位符

  真正图片加载完之前显示占位符

- 使用 LQIP

  - 低质量图像占位符(Low Quality Image Placeholders)
  - npm i lqip

- 使用 SQIP

  - 基于 SVG 的图像占位符(SVG Quality Image Placeholders)
  - npm i sqip


## 图片替代方案

- Web Font 代替图片 - 小图标，针对不同分辨率进行设置
- 使用 Data URI 代替图片 - base64
- 采用 雪碧图 - 多个图合并成大图

## 图片服务器自动优化

- 图片服务器优化是可以在图片 URL 链接上增加不同的特殊参数，服务器自动化生成
- 不同格式、大小、质量的图片
- 处理方式
  - 图片裁剪：按长边、短边、填充、拉伸等缩放
  - 图片格式转换：支持 jpg、gif、png、webp 等，支持不同的图片压缩率
  - 图片处理：添加水印、高斯模糊、重心处理、裁剪边框等
  - AI 能力：鉴黄以及智能抠图、智能排版、智能配色、智能合成等

### 举例

- 默认 jpg

  https://img10.360buyimg.com/babel/s380x300_jfs/t1/131120/3/1242/59767/5ed748acE25ed925e/4354198320bce1bd.jpg

- 大小 100*100 的 jpg

  https://img10.360buyimg.com/babel/s100x100_jfs/t1/131120/3/1242/59767/5ed748acE25ed925e/4354198320bce1bd.jpg

- webp 格式的图片

  https://img10.360buyimg.com/babel/s380x300_jfs/t1/131120/3/1242/59767/5ed748acE25ed925e/4354198320bce1bd.jpg.webp

- 质量压缩至 10%

  https://img10.360buyimg.com/babel/s380x300_jfs/t1/131120/3/1242/59767/5ed748acE25ed925e/4354198320bce1bd.jpg!q10